QuakeWorld TeamFortress 2003
by [sd] angel for MTFL

Полный список всех изменений и дополнений на 28.07.2003.
fix - исправление всевозможных ошибок
add - мелкие (имхо), но полезные дополнения
new - различные нововведения
opt - опциональные возможности (от fix до new)

Скаут:
[fix] По команде "discard" теперь сбрасываются и cells.
      // Как и положенно дискарду, сбрасывает все неиспользуемые типы боеприпасов.
      В некоторых версиях cells использовались для работы сканера, но в 2.8 этого нет.
[fix] Мертвый скаут не может снимать детпаки.
      // Раньше мертвым скаутом можно было начать снимать детпак. Если же респавниться 
      сразу после этого, то детпак снимался уже сам. 
[fix] Исправлен и дополнен класс хелп.
      // Теперь он соответствует действительности.
[fix] Сканер теперь показывает ближайшего противника.
      // Раньше он выбирал кого-то одного, в заданом радиусе, и показывал только на него.
      Если же этот игрок уходил слишком далеко, сканнер вообще никого не показывал, 
      при том, что рядом были и другие игроки противника.
[fix] Убрана ошибка с изменением расстояния скана.
      // Раньше все сканы работали с абсолютно одинаковым scanrange.
      Теперь диапазон работы сканера действительно можно регулировать алиасами.
[add] Добавлен новый алиас sсan50, фактически заменяющий scan100.
      // Так как скан, более чем на 50, не работает (и не работал) впринципе.
      Алиас scan100 оставлен для совместимости конфигов.
[add] Работают алиасы scane и scanf, для сканирования чужих и своих, соответственно.
      // Ранее для этого использовался пре-импульс.
[add] Сканер может показывать более чем на одного игрока.
      // Это возможность была в TF изначально. Только реализована она была так, что клиент ее
      не отрабатывал правильно и потому не отрисовал более одной молнии.
[add] Возможность показа сканером только одной, самой ближайшей цели.
      Работает при "setinfo ms off" или "setinfo multiscan off".
      // Для тех, кому привычнее играть со старым видом сканера.
[new] Встроен автоматический сканер. Включается/выключается командой "autoscan".
      Срабатывает раз в полсекунды. Радиус действия 30 или последний использовавшийся.
      // Ранее это реализовывалось путем забиндивания сканов на движение.
      Что приводило к передаче лишних пакетов и потере более важных импульсов.
[new] Консольные сообщения "Scanning.." и "No blips.." не выводятся при автоскане.
      // Что бы лишнего спама в консоли не было.
[new] Статус автоскана (off/on) и все его настройки выводится в статус бар.
      // Просто очень удобно.
[opt] Возможность включения нового эффекта от flash гранаты:
      В течении 2 секунд экран монитора полностью белый.
      В течении 2 секунд не поступает информация об entity (работает только под qwsv262).
      Включается на сервере "localinfo new_flash on" или "localinfo nf on".
      // Раньше яркость была не полной, из-за чего на разных настройках видео флэш мог
      выглядеть несколько по разному. Теперь на 2 сенунды флэшить будет всех одинакого.
      В случае работы серверной части, противника не сможет увидеть даже игрок с антифлэш :).

Снайпер:
[fix] Исправлен и дополнен класс хелп.
      // Теперь он соответствует действительности.
[add] При попадании пуль в стены, рисуются соответствующие спрайты.
      // Как и у всех остальных классов.
[opt] Возможность сделать мощность снайперской винтовки независимой от fps у игрока.
      Включается на сервере "localinfo snip_fps <число>" или "localinfo sf <число>".
      // Раньше, у игрока с большим fps снайперка взводилась быстрее, чем у игрока с меньшим.
      Таким образом первый игрок получал дополнительное приемущество перед вторым.
      Сейчас можно задать единую скорость взведения винтовки для всех.
      В дальшейшем можно сделать snip_fps (например) 72 стандартом для всех.
[opt] Возможность снятия ограничения на дальность прицельного выстрела.
      Включается на сервере "localinfo snip_range_fix on" или "localinfo srf on".
      // На самом деле, ограничение на дальность прицельного выстрела - это баг :),
						вызваный переполненим буффера. Но сам факт такого ограничения вполне логичен.
      Фикс сделан опциональным, так как он влияет на геймплей на ряде карт.

Солдат:
[add] Команда "special" теперь переключает между ракетницей и двухстволкой.
      // Ранее "special" использовался как алиас для "reload", что просто не рационально. 

Демоман:
[fix] Исправлен класс хелп.
      // Теперь он соответствует действительности.
[fix] Детпак телефрагается, если игрок респавнится внутри него.
      // Теперь нельзя (случайно или специально) заблокировать точку респавна детпаком.
[fix] В 1,5 раза увеличено минимальное допустимое расстояние между двумя детпаками.
      // Теперь между двуми детпаками всегда может пройти игрок.
[add] Добавлена отдельная модель для пайп-лаунчера.
      // Сама моделька такая же, как и у обычного гренад лаунчера, но отличается желтой
      полоской сверху. Очень удобно и наглядно при переключении между лаунчерами.
      В новой серсии клиента qw262 на нее устаналивается cl_currentweapon 7.
[add] Добавлено сообщение "your detpack exploded" для владельца детпака.
      // Что бы сам игрок видел, что взорван именно его детпак.
      Нииболее актуально в случае использования противником EMP.
[new] Полное время до взрыва детпака выводится в статус бар.
      // Раньше для этого приходилось использовать отдельный таймер.
[new] Статус детпака показывается по команде "inv", в независимости от текущего класса
      самого игрока.
      // Игрок всегда может видет состояние своего детпака.

Медик:
[fix] Убран баг с лечением флэша.
      // С появлением новых гранат в 2.8 медик разучился лечить повреждения от старых.
      Вместо лечения флэша он наоборот делал его действие постоянным.
      Теперь он лечит флэш так, как и должен (взято из нынешней версии).
[fix] Когда выбран топор, показывается текущее количество аптечек.
      // Раньше оно вообще не показывалось, а в 2.9 показывалось, но не изменялось
      по мере использования :). Сейчас все работает правильно.
[add] Команда "special" переключает между топором и супер-нейлганом.
      Если гвоздей нет, то между топором и двухстволкой.
      // В ранних версиях "special" переключал топор между биовеапуном и медикитом.
      После того, как две этих функции объединили в одну, смысл в использовании данного
      алиаса отпал. Сейчас же он переключает между топором и основным имеющимся оружием.
[new] Теперь может лечить и "серверный" флэш.
      // На то он и медик :)

Хевигай:
[fix] Энтити "item_armorinv" везде дает до 300 красного армора.
      // На некоторых старых картах (сделаных до того, как хевигаю дали максимум
      в 300 армора), он не мог взять красного армора более 200 или 250 единиц.
      Сейчас максимальное берущееся число армора на всех картах одинакого.
[fix] Теперь может нормально стрелять, стоя на дне водоема.
      // Объективно говоря, это была бага не ТФ, а QW сервера, для которого даже неподвижно 
      стоящий на дне воды игрок, все равно имеет скорость. Скорость эта на столько высока,
      что папик не может начать стрелять, из раскрученной пушки. Эту ошибку удалось обойти.
[add] Команда "special" переключает между пушкой и двухстволкой.
      // В ранних версиях "special" просто переключал на пушку.
[new] Если остается менее 20 патронов, пушка автоматически переключается на двухстволку.
      Расход патронов у пушки уменьшен в 0.1 раза (мощность самой пушки осталась прежней).
      // Хэвик единственый класс, использующий один тип патронов для всех видов оружия.
      По этой причине и из-за высокой скорострельности пушки, он очень часто остается
      вообще без патронов. Дабы немного сбалансировать данный класс изнути, то есть
      не меняя его внешних характеристик, было сделано разделение уже имеющихся
      боеприпасов на две части: для ружей и для пушки. В первой из них всегда находится
      до 20 патронов, а во второй до 180. Таким образом, число и тип носимых боеприпасов
      остался неизменным. Мощность оружия тоже. Дабы сохранить неизменным и макимальное
      время непрерывной стрельбы из пушки, расход патронов в ней был уменьшен на 10%.

Пиро:
[fix] Убран баг с падением болванки напалма.
      // Модель гранаты висит там же, где взрывается сам напалм (взято из нынешней версии)
[fix] Если нет ракет или батареек, то команда "special" всегда переключает на второе основное
      оружие (огнемет или ракетницу, соответственно).
      // Раньше, в такой ситуации, переключившись руками на бумстик, нельзя было вернуться
      с помощью "special" обратно.
[add] При стрельбе из огнемета, динамическое освещение идет не только от ствола самого
      оружия, но и от всего языка пламени.
      // Огонь теперь не только греет, но и светит :)

Спай:
[fix] По команде "discard" теперь сбрасываются и cells.
      // Как и положенно дискарду, сбрасывает все неиспользуемые типы боеприпасов.
      В ранних версиях батарейки использовались для работы спаевских функций,
      но потом от этого отказались. Однако сами батпарейки в дискард добавить забыли.
[fix] С фейнутого спая не берется "id".
      // Раньше, сделав "id" на лежащего спая, можно было безошибочно распознать его.
      В сочетании с используемым большинство autoid, это не оставляло спаю никаких шансов.
[fix] По фейнутому спаю не стреляет сентри.
      // Если неперекрашенный спай фейнился рядом с пушкой, пушка стреляла над ним,
      до тех пор, пока в ней не кончались патроны.
[fix] Когда спай фейнится он выбрасывает все goal_items.
      // Раньше получался просто светящийся трупик, который не всегда было видно.
[fix] Меню "special" корректно работает на картах, где несущему флаг спаю запрещенно
      перекрашиваться.
      // Раньше оно не выводилось вообще, а сейчас выводится в сокращенном виде,
      то есть без пунктов для смены цвета и скина.
[add] Дополнен класс хелп.
      // Теперь он соответствует действительности.
[add] Когда спай лежит, в статус бар выводится надпись "feigned".
      // Удобно и наглядно (особенно тем, кто отключает модели оружия).
[new] Теперь берет в нычке жетый армор.
      // Ранее, 100 единиц зеленого армора выглядили откровенной издевкой над спаем.
      Все из них он мог использовать лишь в случае, если бы его постоянно лечил медик :).
      Иначе потратить более 50 единиц зеленого армора было физически не реально.
      Кроме того, по этим 100 единицам армора, его легко мог распознать вражеский инж.
[new] Максимально количество армора сокращено до 70 единиц.
      // Если 100 единиц зеленого армора были издевательством над самим спаем,
      то 100 единиц желтого армора - это уже издевательство над всеми остальными :).
      Сейчас сделано 70, как промежуточное значение между 40 (при 90 единицах здоровья,
      100 единиц зеленого армора фактически равны 40 единицам желтого) и 100 единицами.
      Этого вполне достаточно для прыжка на гранате (остается еще ~10 брони и ~50 жизни).
[new] Может фейнится в воздухе.
      // А почему бы и нет? Ведь скорость при фейне всегда сбрасывается до нуля и эффектно
      пролететь вражеский дефенс на гранате, прикинувшьсь трупом, все равно не выйдет :)
[new] Может бесшумно фейнится использую команду "sfeign"
      // Вроде как, давно стандартная во всем мире возможность :)
[new] В меню "special" добавлена команда на Silent Feign.
      // Раз есть команда, то она должна быть и в меню.

Инженер:
[fix] Дополнен класс хелп.
      // Теперь он соответствует действительности.
[fix] EMP не взрывает постройки своей команды, если на сервере выключен френдли файр.
      // Очевидный баг, хотя и не особо актуальный в наше время.
[fix] Частично поправлен баг сентри с непопаданием шеллами.
      // Стардартная пушка из 2.8.1 часто не попадает шеллами при стрельбе.
      Данный фикс, взятый из 2.8.1b1, решает эту проблему на большинстве карт.
[add] Статус бар демонстрирует наличие и здоровье диспенсера.
      // Раньше наличие диспенсера приходилось контролировать через меню "build".
[add] Команда "id" показывает здоровье, патроны и ракеты у любой из сентри своей команды.
       Так же показывается и здоровье у диспов.
      // Не нужно каждый раз подходить и проверять все это ударами спаннера.
[add] Добавлено сообщение о взрыве диспенсера (причина взрыва не сообщается).
      // Ранее это вообще никак не отслеживалось. 
[opt] Новый алгоритм стрельбы шеллами у сентри. Теперь она попадает во все, что видит.
      Включается на сервере "localinfo sg fix" или "localinfo sg new".
      // Стандартный лиговский фикс не исправлял баг полностью. Новый алгоритм делает это.
[opt] Возможность сделать поиск цели у сентри независимый от числа игроков,
      при помощи задания аналога определенного числа игроков на сервере.
      Включается на сервере "localinfo sg new" и "localinfo sgppl <число (default 12)>".
      // Сейчас, при игре полными составами и атака на оборону, пушка наводится по-разному.
      Теперь на трене 3 на 3 можно сделать, что бы пушка наводилась так же, как в полной
      игре. Ну, или наоборот, что бы пушка вообще не торомозила на полном сервере.
[opt] Возможность выбора между различными алгоритмами работы сентри.
      Включается на сервере:
						"localinfo sg old" - поиск цели из 2.8, выстрел шеллами из 2.8.
      "localinfo sg fix" - поиск цели из 2.8, выстрел шеллами новый.
      "localinfo sg new" - поиск цели новый, выстрел шеллами новый.
      Любое другое - поиск цели из 2.8, выстрел шеллами лиговский (из tf2.8.1b1).
      // Просто возможность выбора :)

Общее: 
[fix] Убран баг пропадания последней гранаты, при взятии goal_item.
      // Раньше при взятии ряда goal_item (флаги, рюкзаки...) пропадала последняя
      зажатая граната определенного типа. В некоторых случаях (тачдаун флага) это 
      распространялась не только на самого взявшего, но и на всю его команду.
[fix] Убраны ошибки возникающие при взятии армора из goal_item.
      // Теперь армор из рюкзаков берется всегда, причем именно максимально 
      возможного, для данного класса, цвета.
[fix] Убран баг с дупликацией флагов.
      // Раньше, если взять флаг в течении 0.1 до его возвращения, тот брался и возвращался
      одновременно. То есть, на карте появлялось два (и более) флага одного цвета.
[fix] Убран баг с "reload" при вкюченном sbar.
      // Если при включенном sbar вы сбросывали все патроны к оружию, а потом их подбирали,
      то вместо выстрела у вас сначала производился релоад.
[fix] Убран баг с задержкой при выбросе гранат (OmiTF).
      // Иногда при выбросе гранаты возникала дополнительная задержка. Теперь этого нет.
[fix] Аптечки лечат повреждения ног, даже если здоровье у игрока больше или равно
      максимальному.
      // Актуально там, где повреждения ног замедляют скорость.
      Например, при использовании калтропов :).
[fix] Закрыта основная масса дырок, позволяющая менять цвет и скин любым классом.
      // Раньше, легко можно было разгуливать в чужом скине и цвете хоть всю игру.
[fix] Закрыт ряд возможностей для несанкционированной смены цвета и скина спаем.
      Регулируется серверной переменной cheat pause: "localinfo cp <time>" (default 1).
      Для игры на инетных серверах рекомендуется ее значение слегка увеличивать.
      // Так как спай будет постоянно менять цвет и скин, использую команду "disguise",
      то при полном снятии с него задержки на проверку оных, может резко увеличиться число
      покиканых сервером спаев, с плохой связью :). Во избежании подобных проблем, время
      задержки перед проверкой можно выставлять опционально (ранее оно было равно 10).
[add] Команда "showtf" показывает и все новые опциональные настройки.
      // Можно посмотреть данные настройки сервера даже не имея rcon.
[new] Встроенный autoid, делает "id" раз в секунду, не используя импульсы.
      Включается "setinfo autoid on", срабатывает при следующем респавне.
      // Ранее, для реализации autoid, игроки биндили команду "id" себе на движения.
      Из-за этого часто не срабатывали другие, причем более важные импульсы.
      Да и просто клиент постоянно слал ненужные импульсы на сервер.
      Теперь же данная информация передается всем желающим автоматически,
      вообще без использования импульсов.
[new] Добавлена новая возможность настройки через битовую маску "setinfo s <число>"
      1 - exec map on
      2 - exec class on
      4 - class help on
      8 - autoid on
      16 - multiscan off (только для скаута)
      32 - status stats off - отключение вывода информации об здоровье и броне.
      64 - status coord off - отключение вывода информации о координатах.
      128 - status spy off - отключение вывода информации о скине спаев.
      // Сделано для экономии места в setinfo.
[new] Настраиваемый дискард: 
      "setinfo mxs <сколько оставить>" или "setinfo 1 <сколько оставить>"
      "setinfo mxn <сколько оставить>" или "setinfo 2 <сколько оставить>"
      "setinfo mxr <сколько оставить>" или "setinfo 3 <сколько оставить>"
      "setinfo mxc <сколько оставить>" или "setinfo 4 <сколько оставить>"
      Пустая строка означает стандартный дискард для данных боеприпасов.
      // Сделать настраиваемый сброс патронов можно сделать и в клиенте, через "dropitem"
      Однако, из-за кучи расбросаных коробок были проблемы с числом entity на сервере.
      Тепепь все ненужные боеприпасы можно сбрасывать проще и одним рюкзаком.
[new] В "showclasses" добавлена информация об арморе, здоровье и координатах игроков.
      // Упрощенный треккер, доступный всем. Легко преобразуется в полноценный треккер 
      на худах уже в самом клиенте. Очень полезная, для координации внутри команды, вещь.
[new] Реализовано сохранение наиболее важных импульсов.
      // Импульсы терялись во время стрельбы, так как во время анимации выстрела нельзя
     пользоватся импульсами. Раньше такие импульсы терялись, теперь они срабатывают по
     окончании анимации. При стрельбе из пулеметов надо делать паузу, что импульс сработал.
[new] Возможность фиксировать единый цвет topcolor для каждой из команд.
      Включается на сервере (срабатыает после смены карты):
      "localinfo tc1 <color>"
      "localinfo tc2 <color>"
      "localinfo tc3 <color>"
      "localinfo tc4 <color>"
      По умолчанию цвет topcolor равен цвету команды. Диапазон выбора цвета от 0 до 15.
      Если установленно хоть одно из этих значений, то включается серверная проверка topcolor.
      // Если кто забыл, использование команды topcolor официально запрещено правилами.
      Но всегда находятся те, кто этот запрет нарушает и те, кто этим нарушением недоволен.
      Теперь данную проблему можно легко и быстро решить серверно :).
      Кроме того, есть возможноть присваивать команде определенный единый цвет topcolor,
      отличный от цвета самой команды. Это будет крайне полезно для распознавания своих
      соклановцев на турнирах, где одному и тому же клану часто приходится играть за разные
      цвета. Причем, всё это осуществляется не ущемляя права спаев. Так как при смене ими
      командного цвета, топколор так же автоматически будет меняться на вражеский.     
[opt] Возможность вывода времени до возврата флага по команде "flaginfo".
      Включается на сервере "localinfo flag_timer on" или "localinfo ft on".
      // Так как часть игроков сейчас уже использует таймеры, написаные по средствам
      возможностей современных клиентов, то будет вполне логично упостить получение данной
      информации и сделать ее доступной вообще всем.
[opt] Возможность включения рандомного командного респавна.
      Включается на сервере "localinfo random_team_spawn on" или "localinfo rts on".
      // Порядок точек респавна будет задаваться не циклически (как сейчас прописано 
      в самой карте), а по случаному принципу. Таким образом будет нельзя заранее просчитать
      место своего последующего респавна.
[opt] Возможность запрета использования powerups на всех картах.
      Включается на сервере "localinfo disable_powerups on" или "localinfo dp on".
      // Что бы не переделывать каждую новую карту в отдельности.
      Разумеется для нынешних лиговских карт эта опция просто не нужна.
[opt] Возможность запрета использования определенных гранат и детпака.
      Включается на сервере "localinfo disable_grens <число>" или "localinfo dg <число>".
      NORMAL  2                     	
      CONCUSSION  4 
      NAIL  8
      MIRV  6
      NAPALM  32
      FLARE  64             
      GAS  128
      EMP  256
      FLASH  512
      CALTROPS  1024
      DETPACK  2048
      // Что бы не переделывать каждую новую карту в отдельности и иметь возможность
      гибкой настройки запретов. Нужно приемущественно для аренных и мясных карт.
[opt] Возможность подбирать из рюкзаков убитых не только патроны.
      Включается на сервере "localinfo g2b <число>"
      GREN		1		
      GREN_BYTYPE		2		
      ARMOR		4
      HEALTH		8
      DETPACK		16
      // Возможность более чем логичная, но изначально в тф отсутствующая.
      При "1" гранаты берутся как в нычке, то есть различаются лишь на gren1 и gren2.
      При "2", можно взять лишь гранаты того типа, что может использовать сам класс,
      которым играет, подобравший рюкзак. Например, солдат не сможет взять напалм.
      Армор берется лишь в случае, когда его в рюкзаке больше, чем у самого игрока.
      Здоровье берется только из рюкзаков медика, при наличии в нем медикитов.
      Сделано опционально, так как влияние на геймплей будет весьма существенным.
      
Данная версия не является окончательной.

Написано на основе TF 2.8.1, c применением кодов из TF 2.8.1b1, TF 2.9, Clan TF 3.0,
Dragon TF, Omi TF и целого ряда оригинальных разработок.

Идеи и программирование - [sd] angel
Идеи, бета-тестирование и составление документации - [sd] hunter

http://clan.sd.ru
http://mtfl.sd.ru
